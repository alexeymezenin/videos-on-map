function initMap(){window.markers=[],window.infowindows=[],window.markerWasNotJustClicked=!0,mapEl=document.getElementById("map"),window.map=new google.maps.Map(document.getElementById("map"),{zoom:parseInt(mapEl.dataset.zoom),center:{lat:parseFloat(mapEl.dataset.lat),lng:parseFloat(mapEl.dataset.lng)},minZoom:4,maxZoom:15}),window.map.addListener("idle",()=>{window.markerWasNotJustClicked&&(loadMarkers(),closeInfoWindow()),window.markerWasNotJustClicked=!0})}function loadMarkers(){clearMarkers(),window.map.getBounds()&&fetch("/api/videos?llat="+window.map.getBounds().getSouthWest().lat()+"&llng="+window.map.getBounds().getSouthWest().lng()+"&rlat="+window.map.getBounds().getNorthEast().lat()+"&rlng="+window.map.getBounds().getNorthEast().lng()).then(o=>o.json()).then(o=>putMarkersOnMap(o)).catch(o=>{})}function putMarkersOnMap(o){let n;if(o.data)for(n of o.data)putOneMarkerOnMap(n)}function putOneMarkerOnMap(o){let n;n=new google.maps.Marker({position:{lat:Number(o.lat),lng:Number(o.lng)},map:window.map}),window.markers.push(n),addInfoWindowForMarker(n,'<iframe width="560" height="315" src="https://www.youtube.com/embed/'+o.youtube_id+'" frameborder="0" allow="autoplay;" allowFullScreen></iframe>')}function addInfoWindowForMarker(o,n){let e=new google.maps.InfoWindow;window.infowindows.push(e),google.maps.event.addListener(o,"click",function(o,n,e){return function(){window.markerWasNotJustClicked=!1,window.infowindows.forEach(o=>{o.close()}),e.setContent(n),e.open(window.map,o)}}(o,n,e))}function clearMarkers(){window.markers.forEach(function(o){o.setMap(null)}),window.markers=[]}function closeInfoWindow(){window.infowindow&&window.infowindow.close()}